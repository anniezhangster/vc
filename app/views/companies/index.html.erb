<% title 'Home' %>

<div class="panel panel-default">
  <div class="panel-heading">
    <h1>All Companies</h1>
  </div>
  <div class="panel-body">
    <h4>
      Soon-to-be pitching companies are shown in blue. Companies being voted on are yellow.
    </h4>
  </div>
  <div class="list-group">
    <% @companies.each do |company| %>
      <a
        class="list-group-item companies--item"
        href="<%= new_company_vote_path(company) %>"
      >
        <div class="list-group-item-heading">
          <p class="companies--large-heading text-<%= company_class(company) %>">
            <%= company.name %>
          </p>
          <p class='companies--sub-heading' title="Quorum at <%= company.stats["required_votes"] %>">
            <%= company.pitch_on.to_s(:long) %>
          </p>
          <p class='companies--sub-heading'>
           <%= company.partner_initials.join(', ') %>
          </p>
        </div>
        <div class="list-group-item-text">
          <% if company.past_deadline? %>
            <div class="row">
              <div class="col-sm-6 text-success">
                <%= render partial: 'stat', locals: {name: 'yes', value: company.stats["yes_votes"]} %>
              </div>
              <div class="col-sm-6 text-danger">
                <%= render partial: 'stat', locals: {name: 'no', value: company.stats["no_votes"]} %>
              </div>
            </div>
            <br>
            <div class="row companies--smaller">
              <% company.stats[:averages].each do |name, value| %>
                <div class="col-sm-3">
                  <%= render partial: 'stat', locals: {name: name, value: value} %>
                </div>
              <% end %>
            </div>
          <% elsif company.pitched? %>
            <p class='companies--heading'>
              Pitched on <%= company.pitch_on.to_s(:long) %>
              <br>
              <% vote = company.user_votes(current_user).first %>
              <% if vote.blank? %>
                You have not yet voted
              <% elsif vote.final? %>
                You have submitted your final vote
              <% else %>
                You have submitted your pre-vote
              <% end %>
            </p>
          <% else %>
            <p class='companies--heading'>
              Pitching on <%= company.pitch_on.to_s(:long) %>
            </p>
          <% end %>
        </div>
      </a>
    <% end %>
  </div>
</div>
